---
layout: post
title: "Lesson 01: Work With Shapefile Attributes in R"
date:   2015-10-25
authors: "Joseph Stachelek, Leah Wasser"
dateCreated:  2015-10-23
lastModified: 2015-10-26
tags: [module-1]
description: "This post explains the nature of shapefile attributes. Participants will be able to locate and query shapefile attributes as well as subset shapefiles by specific attribute values."
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/shapefile-attributes-in-R/
---

<section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section><!-- /#table-of-contents -->


##About
This lesson explains what attributes in shapefiles are. It also covers how to work 
with shapefile attributes in `R`. It covers how to identify and query shapefile 
attributes as well as subset shapefiles by specific attribute values. Finally,
we will review how to plot a shapefile according to a set of attribute values.

###Goals / Objectives
After completing this activity, you will:

 * Be able to query shapefile attributes
 * Be able to subset shapefiles based on specific attributes
 
 
<div id="objectives">
<h3>What you'll need</h3>

You will need the most current version of R or R studio loaded on your computer 
to complete this lesson.

<h3>R Libraries to Install:</h3>
<ul>
<li><strong>raster:</strong> <code> install.packages("raster")</code></li>
<li><strong>rgdal:</strong> <code> install.packages("rgdal")</code></li>
<li><strong>ggplot2:</strong> <code> install.packages("ggplot2")</code></li>
</ul>

<a href="{{ site.baseurl }}/R/Packages-In-R/" target="_blank"> 
More on Packages in R - Adapted from Software Carpentry.</a>

<h2>Data to Download</h2>

Download the shapefiles neede to complete this lesson:

<a href="http://files.figshare.com/2387960/boundaryFiles.zip" class="btn btn-success"> 
DOWNLOAD Harvard Forest Shapefiles</a>

<h3>Recommended Reading</h3>
This lesson is a part of a series on vector and raster data in R.

<ol>
<li> <a href="{{ site.baseurl }}/R/open-shapefiles-in-R/">
Intro to shapefiles in R</a></li>
<li><a href="{{ site.baseurl }}/R/shapefile-attributes-in-R/">
Working With Shapefile Attributes in R </a></li>
<li><a href="{{ site.baseurl }}/R/csv-to-shapefile-R/">
CSV to Shapefile in R</a></li>
<li><a href="{{ site.baseurl }}/R/crop-extract-raster-data-R/">
Crop and extract raster values in R</a></li>
</ol>

</div>

NOTE: The data used in this tutorial were collected at Harvard Forest which is
a the National Ecological Observatory Network field site <a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
More about the NEON Harvard Forest field site</a>. These data are proxy data for what will be
available for 30 years from the NEON flux tower [from the NEON data portal](http://data.neoninc.org/ "NEON data").
{: .notice}
 
 ##Notes about R Libraries

To work with vector data in R, we can use the `rgdal` library. We will load the `raster`
library to work with rasters. The `raster` library also allows us to explore metadata
using similar commands with both rasters and vectors.
 
##Querying shapefile attributes
```{r load-libraries-data }

library(rgdal)
#in case the libraries and data are not still loaded

#Import a polygon shapefile 
aoiBoundary <- readOGR("boundaryFiles/HARV/", "HarClip_UTMZ18")

#Import a line shapefile
lines <- readOGR( "boundaryFiles/HARV/",layer = "HARV_roadStream")

#Import a point shapefile 
point <- readOGR("boundaryFiles/HARV/", "HARVtower_UTM18N")

```

Recall from the previous lesson that shapefile metadata can include a _class_, 
a _features_ count, an _extent_, and a _coordinate reference system_ (crs). 
Shapefile _attributes_ include measurements that correspond to the geometry of 
the shapefile features.

Metadata can be extracted individually using the `class()`, `length()`, `extent()`, 
`crs()`, `R` commands. Attributes can be extracted using the `slot()` command. 

```{r view-shapefile-metadata }

#view class
class(x = aoiBoundary)
class(x = lines)
class(x = point)

#view features count
length(x = aoiBoundary)
length(x = lines)
length(x = point)

#view crs - note - this only works with the raster package loaded
crs(x = aoiBoundary)
crs(x = lines)
crs(x = point)

#view extent
extent(x = squarePlot)
extent(x = lines)
extent(x = point)

```

#Shapefile Attributes

Shapefiles often contain an associated database or spreadsheet of values called
`attributes` that describe the vector features in the shapefile. You can think
of this like a spreadsheet with rows and columns. Each column in the spreadsheet
is an individual `Attribute` that describes an object.

For example, the `roads_stream` shapefile contains an attribute called `TYPE`. Each
line in the shapefile has an associated type which describes the type of road, or 
element in the file. 


You can quickly view all attributes of a spatial object in r using the `@data`. 
Let's give it a try.

```{r view-shapefile-attributes }

#view just the attribute names for the lines spatial object
names(lines@data)

#view all attribute data for the lines spatial object
lines@data 

#view just the tope 5 attributes for the lines spatial object
head(lines@data)

#view attributes for the other spatial objects
aoiBoundary@data
point@data

```

#CHALLENGE
Explore the attributes associated with the `point` and `aoiBoundary` spatial objects. 

1. How many attributes do each have?
2. Another question??

#Exploring values in One Attribute
We can also explore individual values stored within a particulat attribute. Again,
comparing attributes to a spreadsheet or a `data.frame`, this is similar to 
exploring values in a column. We can do this using the `$`.

```{r explore-attribute-values }

#view all attributes in the lines shapefile within the TYPE field
lines$TYPE

#view unique attributes in the lines shapefiles within the Type field
levels(lines$TYPE)

```

#How do you access the LEVELS when working with categorical variables in a shapefile?

##Subsetting shapefiles

Using the `$` symbol, we were able to access the values associated with a 
particular `Attribute` in a shapefile. Next, we will use this syntax to select 
a subset of features from a spatial object in `R`. 

Note how our subsetting operation reduces the _features_ count from 13 to 2. 

```{r Subsetting shapefiles}

#view all attributes in the TYPE column
lines$TYPE

#select features that are of TYPE "footpath"
lines[lines$TYPE == "footpath",]

```


#I think we should plot by attribute HERE - given we are introducing attributes here
#we should also have some sort of application - maybe we want to find out in a point data set 
#how many points are of type "X"
#can we run summary stats on the different categories?

#Plotting Spatial Data in R

We can use the `col` argument to the `plot()` function to specify 
the color of spatial objects. If type is an attribute of our data, 
we can use the syntax `$TYPE` to tell `R` to plot the spatial
objects according to their unique TYPE values. 

The following code chunk extracts a vector of this attribute, creates 
a character color vector of the same length, and changes the positions 
of this color vector that correspond to _footpath_.

#NOTE -- It's worth visiting this to determine the BEST and most efficient
way to plot by attribute. The TYPE is a factor in R world -
#it's a categorical attribute. We should teach best practices but I am not sure
#what that is in R.

we should plot:
* then add a legend
* color by road type and add that to the legend.
* this would be a typical workflow.


```{r Color lines by attribute}
#color lines by TYPE attribute
type <- slot(object = lines, name = "data")$TYPE
#you can also write
type <- lines@data$TYPE

col <- rep(x= "black", length = length(type))
col[type == "footpath"] <- "red"

plot(x=lines, col=col,add=T)

```

#some other challenge?
#maybe plotting should be it's own lesson in this set??

```{r}

```
