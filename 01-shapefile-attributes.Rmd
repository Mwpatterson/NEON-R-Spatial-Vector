---
layout: post
title: "Lesson 01: Work With Shapefile Attributes in R"
date:   2015-10-25
authors: [Joseph Stachelek, Leah Wasser]
contributors: [Megan A. Jones]
dateCreated:  2015-10-23
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
tags: [module-1]
description: "This post explains the nature of shapefile attributes. Participants will be able to locate and query shapefile attributes as well as subset shapefiles by specific attribute values."
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/shapefile-attributes-in-R/
comments: false
---

{% include _toc.html %}


##About
This lesson explains what attributes in shapefiles are. It also covers how to work 
with shapefile attributes in `R`. It covers how to identify and query shapefile 
attributes as well as subset shapefiles by specific attribute values. Finally,
we will review how to plot a shapefile according to a set of attribute values.

<div id="objectives" markdown="1">

###Goals / Objectives
After completing this activity, you will:

 * Be able to query shapefile attributes
 * Be able to subset shapefiles based on specific attributes
 
###What you'll need

You will need the most current version of R or R studio loaded on your computer 
to complete this lesson.

###R Libraries to Install:


* **raster:** `install.packages("raster")`
* **sp:** `install.packages("sp")`
* **rgdal:** `install.packages("rgdal")`


<a href="{{ site.baseurl }}/R/Packages-In-R/" target="_blank"> 
More on Packages in R - Adapted from Software Carpentry.</a>

##Data to Download

Download the shapefiles needed to complete this lesson:

<a href="http://files.figshare.com/2387960/boundaryFiles.zip" class="btn btn-success"> 
DOWNLOAD Harvard Forest Shapefiles</a>

###Recommended Reading

This lesson is a part of a series on vector and raster data in R.

1. <a href="{{ site.baseurl }}/R/open-shapefiles-in-R/">
Intro to shapefiles in R</a>
2. <a href="{{ site.baseurl }}/R/shapefile-attributes-in-R/">
Working With Shapefile Attributes in R </a>
3. <a href="{{ site.baseurl }}/R/csv-to-shapefile-R/">
CSV to Shapefile in R</a>
4. <a href="{{ site.baseurl }}/R/crop-extract-raster-data-R/">
Crop and extract raster values in R</a>

</div>

NOTE: The data used in this tutorial were collected at Harvard Forest which is
a the National Ecological Observatory Network field site <a 
href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
More about the NEON Harvard Forest field site</a>. These data are proxy data for
what will be available for 30 years from the NEON flux tower [from the NEON data portal](http://data.neoninc.org/ "NEON data").
{: .notice}
 
##Notes about R Libraries

To work with vector data in R, we can use the `rgdal` library. We will load the 
`raster` library to work with rasters. The `raster` library also allows us to 
explore metadata using similar commands with both rasters and vectors.

##Setting up the workspace
If you completed Lesson 00  {{site.baseurl}}R/open-shapefiles-in-R/  you can skip this code chunk.
```{r load-libraries-data }

library(rgdal)
library (raster)   #notice sp package should always load with raster. 
#in case the libraries and data are not still loaded

#Import a polygon shapefile 
aoiBoundary <- readOGR("boundaryFiles/HARV/", "HarClip_UTMZ18")

#Import a line shapefile
lines <- readOGR( "boundaryFiles/HARV/",layer = "HARV_roads")

#Import a point shapefile 
point <- readOGR("boundaryFiles/HARV/", "HARVtower_UTM18N")

```

##Querying shapefile metadata 
Recall from the previous lesson that shapefile metadata can include a `class`, 
a `features` count, an `extent`, and a `coordinate reference system` (crs). 

Metadata can be extracted individually using the `class()`, `length()`, 
`extent()`, `crs()`, `R` commands. 

```{r view-shapefile-metadata }

#view class
class(x = aoiBoundary)
class(x = lines)
class(x = point)

#view features count
length(x = aoiBoundary)
length(x = lines)
length(x = point)

#view crs - note - this only works with the raster package loaded
crs(x = aoiBoundary)
crs(x = lines)
crs(x = point)

#view extent
extent(x = squarePlot)
extent(x = lines)
extent(x = point)

```

#Querying Shapefile Attributes
Shapefiles often contain an associated database or spreadsheet of values called
`attributes` that describe the vector features in the shapefile. You can think
of this like a spreadsheet with rows and columns. Each column in the spreadsheet
is an individual `Attribute` that describes an object. Shapefile `attributes` 
include measurements that correspond to the geometry of the shapefile features.

For example, the `roads` shapefile contains an attribute called `TYPE`. Each
line in the shapefile has an associated type which describes the type of road, or 
element in the file. 


You can quickly view all attributes of a spatial object in r using the `@data`. 
Bonus: If you are comfortable using `slot()` it is another method to do the same
thing. 

Let's give it a try.

```{r view-shapefile-attributes }

#view just the attribute names for the lines spatial object
names(lines@data)

#view all attribute data for the lines spatial object
lines@data 

#view just the tope 5 attributes for the lines spatial object
head(lines@data)

#view attributes for the other spatial objects
aoiBoundary@data
point@data

```

#CHALLENGE
Explore the attributes associated with the `point` and `aoiBoundary` spatial objects. 

1. How many attributes do each have?
2. Who owns the site in the `point` file? 

#Exploring Values in One Attribute
We can also explore individual values stored within a particulat attribute. Again,
comparing attributes to a spreadsheet or a `data.frame`, this is similar to 
exploring values in a column. We can do this using the `$`.

```{r explore-attribute-values }

#view all attributes in the lines shapefile within the TYPE field
lines$TYPE

#view unique attributes in the lines shapefiles within the Type field
levels(lines$TYPE)

```

#Acessing levels for categorical variables

##Subsetting shapefiles

Using the `$` symbol, we were able to access the values associated with a 
particular `Attribute` in a shapefile. Next, we will use this syntax to select 
a subset of features from a spatial object in `R`. 

Note how our subsetting operation reduces the `features` count from 13 to 2. 

```{r Subsetting shapefiles}

#view all attributes in the TYPE column
lines$TYPE

#select features that are of TYPE "footpath"
lines[lines$TYPE == "footpath",]

```

#Plotting Vector Data in R

The following code chunk extracts a vector of this attribute, creates 
a character color vector of the same length, and changes the positions 
of this color vector that correspond to `footpath`.

We can use the `col` argument in the `plot()` function to specify the color of
spatial objects. If type is an attribute of our data, we can use the syntax
`$TYPE` to tell `R` to plot the spatial objects according to their unique TYPE
values. 

```{r Color lines by attribute}
#add legend to previous plot


#color lines by TYPE attribute
#1st create object that is the TYPE attribute (you could just do this directly
#in the col {} below but this makes for cleaner code)
type <- lines@data$TYPE
#Bonus: if you prefer using slot(). 
type <- slot(object = lines, name = "data")$TYPE

#2nd set the color for all the lines 
col <- rep(x= "black", length = length(type))

#3rd specify the color you want for the TYPE level you want 
col[type == "footpath"] <- "red"

#4th plot. Add is still true because we want this to map onto the previous plot 
plot(x=lines, col=col,add=TRUE)

```
