---
layout: post
title: "Lesson 00: Open and Plot Shapefiles in R - Getting Started with Point,
Line and Polygon Vector Data"
date:   2015-10-26
authors: [Joseph Stachelek, Leah Wasser, Megan A. Jones]
contributors: [Sarah Newman]
dateCreated:  2015-10-23
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
packagesLibraries: [rgdal, raster]
category: 
mainTag: vector-data-workshop
tags: [vector-data, vector-data-workshop]
description: "This spatial data lesson explains the how to open and plot 
Shapefiles containing point, line and polygon vector data in R."
code1: 00-open-a-shapefile.R
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network  (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/open-shapefiles-in-R/
comments: false
---

{% include _toc.html %}

##About
In this lesson we will open and plot point, line and polygon vector data, 
stored in shapefile format in `R`.

**R Skill Level:** Introduction - you are just getting started with spatial data
in `R`, but have some of the other basics down.

<div id="objectives" markdown="1">

##Goals / Objectives
After completing this activity, you will:

 * Know the difference between point, line, and polygon vector elements.
 * Understand the differences between opening point, line and polygon shapefiles
    in `R`.
 * Understand the components of a spatial object in `R`.

##Things You'll Need To Complete This Lesson

You will need the most current version of `R` and, preferably, `RStudio` loaded 
on your computer to complete this lesson.

##R Libraries to Install:

* **raster:** `install.packages("raster")`
* **rgdal:** `install.packages("rgdal")`
* **sp:** `install.packages("sp")`

* <a href="http://neondataskills.org/R/Packages-In-R/" target="_blank">More on Packages in R - Adapted from Software Carpentry.</a>

##Data to Download
{% include/dataSubsets/_data_Site-Layout-Files.html %}

**Set Working Directory:** This lessons assumes that you have set your working 
directory to the location of the downloaded and unzipped data subset. 
[An overview of setting the working directory in `R` can be found here.]({{site.baseurl}}/R/Set-Working-Directory "R Working Directory Lesson") 

**Challenge Code:** NEON Data Skills tutorials often contain challenges that
reinforce learned skills. If available, the code for challenge solutions is
found in a downloadable `R` script available at the bottom of each lesson page.

**Vector Lesson Series:** This lesson is a part of a lesson series on 
[spatial vector data in `R`]({{site.baseurl}}/R/spatial-vector-lessons).
</div>

#About Vector Data
Vector data are composed of discrete geometric locations (x,y values) that
define object vertices and in turn the "shape" of the object. The organization 
of the geometric locations, determines the type of vector that we are working 
with: point, line or polygon.

<figure>
    <a href="{{ site.baseurl }}/images/pnt_line_poly.png">
    <img src="{{ site.baseurl }}/images/pnt_line_poly.png"></a>
    <figcaption> There are 3 major types of vector objects: points, lines or 
    polygons. Each object type has a different structure. 
    Image Source: National Ecological Observatory Network (NEON) 
    </figcaption>
</figure>

* **Points:** Each individual point is define by a single x, y coordinate.
There can be many points in a vector point file. Examples of point data include:
sampling locations, the location of individual trees or the location of plots.
* **Lines:** Lines are composed of many (at least 2) vertices, or points, that
are connected. For instance, a road or a stream may be represented by a line. This
line is composed of a series of segments, each "bend"" in the road or stream 
represents a vertex that has defined x,y location.
* **Polygons:** A polygon consists of 3 or more vertices that are connected and 
"closed". Thus the outlines of plot boundaries, lakes, oceans, and states or 
countries are often represented by polygons. Occasionally, a polygon can have a
hole in the middle of it (like a doughnut), this is something to be aware of but
not an issue we will deal with in this lesson.

 <i class="fa fa-star"></i> **Data Tip:** Sometimes, boundary layers such as 
 states and countries, are stored as lines rather than polygons. However, these
 boundaries, when represented as a line, will not create a closed object that we
 can apply a "fill" to OR that we can calculate the area of.  
{: .notice}


##Shapefiles: Points, Lines, and Polygons
Geospatial data in vector format is often stored in a `shapefile` format. 
Because the structure of points, lines, and polygons are different, each
individual shapefile can only contain one vector type (all points, all lines
or all polygons). You will not find a mixture of point, line and polygon
objects in a single shapefile!

Objects stored in a shapefile often have a set of associated `attributes` that
describe the data. For example, a line shapefile that contains the locations of 
streams, might contain the associated stream name and the stream "order".

* More about shapefiles can found on
[Wikipedia](https://en.wikipedia.org/wiki/Shapefile).

##Import Shapefiles

We will use the `rgdal` package to work with vector data in `R`. Notice that the
`sp` package automatically loads when `rgdal` is loaded. We will also load the
`raster` package so we can explore raster and vector spatial metadata using similar commands.  

```{r load-libraries }

#load required libraries
#for vector work; sp package will load with rgdal.
library(rgdal)  
#for metadata/attributes- vectors or rasters
library(raster) 

#set working directory to the directory location on your computer where
#you downloaded and unzipped the data files for the lesson
#setwd("pathToDirHere")
```

The shapefiles that we will import are:

* a polygon shapefile representing our field site boundary, 
* a line shapefile representing roads, and 
* a point shapefile representing the location of a  
<a href="http://www.neoninc.org/science-design/collection-methods/flux-tower-measurements" target="_blank"> flux tower</a> 
located at the
<a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank"> NEON Harvard Forest field site</a>.

The first shapefile that we will open contains the boundary of our study area
(or our Area Of Interest, hence the name `aoiBoundary`). To import shapefiles we
use the `R` function `readOGR()`.

```{r Import-Shapefile}

#Import a polygon shapefile: readOGR("path","fileName")
#no extension needed as readOGR only imports shapefiles
aoiBoundary_HARV <- readOGR("NEON-DS-Site-Layout-Files/HARV",
                            "HarClip_UTMZ18")

```

<i class="fa fa-star"></i> **Data Tip:** The acronym, OGR refers to the
OpenGIS Simple Features Reference Implementation. 
<a href="https://trac.osgeo.org/gdal/wiki/FAQGeneral" target="_blank"> 
Learn more about OGR.</a> 
{: .notice}  

#Shapefile Metadata & Attributes

When we import the `HarClip_UTMZ18` shapefile layer into `R` (as our
`aoiBoundary_HARV` object), the `readOGR()` function automatically stores
information about the data. We are particularly interested
in the geospatial *metadata* that describe the format, `CRS`, `extent`, and
other components of the dataset, as well as, 
*attributes* which describe properties associated with each individual vector 
object

 <i class="fa fa-star"></i> **Data Tip:** The 
 [Shapefile Metadata & Attributes in R]({{site.baseurl}}R/shapefile-attributes-in-R/) 
lesson provides more information on both metadata and attributes as well as
using attributes to subset and plot data. 
{: .notice}

##Spatial Metadata
Key metadata for all shapefiles include:

1. **Object Type:** the class of the imported object. 
2. **Coordinate Reference System (`CRS`):** the projection of the data.
3. **Extent:** the spatial extent of the shapefile. Note that the spatial
extent for a shapefile represents the extent for ALL spatial objects in the
shapefile.

We can view shapefile metadata using the `class`, `crs` and `extent` methods:

```{r view-metadata }
#view just the class for the shapefile
class(aoiBoundary_HARV)

#view just the crs for the shapefile
crs(aoiBoundary_HARV)

#view just the extent for the shapefile
extent(aoiBoundary_HARV)

#view all metadata at same time
aoiBoundary_HARV
```

Our `aoiBoundary_HARV` object is a polygon of class `SpatialPolygonsDataFrame`, 
in the `CRS` **UTM zone 18N**. The `CRS` is critical to interpreting the
object `extent` values as it specifies units. 

##Spatial Data Attributes
Each object in a shapefile has one or more attributes associated with it.
Shapefile attributes are similar to fields or columns in a spreadsheet. Each row
in the spreadsheet has a set of columns associated with it that describe the row
element. In the case of a shapefile, each row represents a spatial object - for
example a road, represented as a line in a line shapefile will have one "row" of
attributes associated with it. These attributes can include different types of
information that describe objects stored within a shapefile. Thus, our road, may
have a name, length, number of lanes, speed limit, type of
road and other attributes stored with it. 

We view the attributes of a `SpatialPolygonsDataFrame` by using the
`attributes()` function. 

``` {r Shapefile-attributes-2}
#alternate way to view attributes 
attributes(aoiBoundary_HARV)
```

## Metadata & Attribute Summary
We can view a metadata & attribute summary of each shapefile by entering 
the name of the `R` object in the console. Note that the metadata output
includes the _class_, the number of _features_, the _extent_, and the coordinate
reference system (`CRS`) of the `R` object. The last two lines of summary show a
preview of the `R` object _attributes_.

```{r shapefile-summary}
#view a summary of metadata & attributes associated with the spatial object
summary(aoiBoundary_HARV)

```

<div id="challenge" markdown="1">

##Challenge: Attributes & Metadata
What is the difference between the information on the dataset you get from
entering the object name, `summary()` and `attributes()`. When might you prefer
to use one or the other?
</div>

``` {r challenge-code-attributes, echo=FALSE}
# Entering just the name provides the most commonly needed information: CRS,
# Extent, item names, and min & max values.  `attributes()` prints out all the 
# "slots" associated with the object.  These "slots" are areas where different
# types of data can be stored. Notice that `attributes()` provides all the
# information the name alone does while providing more information as well. 
# Summary provides 

```

#Plot a Shapefile
Next, let's visualize a shapefile. Using `plot()`, we can produce a box
representing the boundaries specified in this shapefile.

``` {r plot-shapefile}
#create a plot of the shapefile
# 'lwd' sets the line width
# 'col' sets internal color
# 'border' sets line color
plot(aoiBoundary_HARV, col="cyan1", border="black", lwd=3)

```

<div id="challenge" markdown="1">
##Challenge: Import Line and Point Shapefiles
Using the steps above, import the HARV_roads and HARVtower_UTM18N layers into
`R`. Call the Harv_roads object `lines_HARV` and the HARVtower_UTM18N
`point_HARV`.

Answer the following questions:

1. What type of `R` spatial object is created when you import each layer?
2. What is the `CRS` and `extent`for each object?
3. Do the files contain, points, lines or polygons?
4. How many spatial objects are in each file?
</div>

```{r import-point-line, echo=FALSE, results="hide" }
#import line shapefile
lines_HARV <- readOGR("NEON-DS-Site-Layout-Files/HARV",layer = "HARV_roads")
#import point shapefile
point_HARV <- readOGR("NEON-DS-Site-Layout-Files/HARV", layer="HARVtower_UTM18N")

#1
class (lines_HARV)
class (point_HARV)

#2
crs(lines_HARV)
extent(lines_HARV)
crs(point_HARV)
extent(point_HARV)

#3 
#lines_HARV contains only lines and point_HARV contains only 1 point

#4 -> numerous ways to find this; lines_HARV=13,
length(lines_HARV)  #easiest, but not previously taught
lines_HARV  #look at 'features'
attributes(lines_HARV)  #found in the $data section as above

#Alternative code for 1-4: view metadata/attributes all at once
lines_HARV
attributes(lines_HARV)

```


#Plot Multiple Shapefiles
The `plot()` function can be used for basic plotting of spatial objects. 
We use the `add = TRUE` argument to overlay shapefiles on top of each other, as
we would when creating a map in a typical GIS application like QGIS.

We can use `main=""` to give our plot a title. If you want the title to 
span 2 lines, use `\n` where you'd like the line break.

```{r plot-multiple-shapefiles }
#Plot multiple shapefiles
plot(aoiBoundary_HARV, col = "lightgreen", 
     main="NEON Harvard Forest\nField Site")
plot(lines_HARV, add = TRUE)

#use the pch element to adjust the symbology of the points
plot(point_HARV, add  = TRUE, pch = 19, col = "purple")
```

***

##Additional Resources
For more on parameter options in the base `R` `plot()` function, check out these
resources:

* <a href="http://www.statmethods.net/advgraphs/parameters.html" target="_blank">Parameter methods in `R`.</a>
* <a href="https://codeyarns.files.wordpress.com/2011/07/20110729-vim-named-colors.png?w=700" target="_blank">Color names in `R`</a>
