---
layout: post
title: "Lesson 00: Vector Data in R - Open and Plot Shapefiles"
date:   2015-10-26
authors: [Joseph Stachelek, Leah Wasser]
contributors: [Megan A. Jones, Sarah Newman]
dateCreated:  2015-10-23
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
tags: [module-1]
description: "This post explains the how to open and plot point, line, and polygon shapefiles in R."
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/open-shapefiles-in-R/
comments: false
---

{% include _toc.html %}


##About
In this lesson, we will work with vector data in R. We will open and plot point, 
line, and polygon data, stored in shapefile format.

<div id="objectives" markdown="1">

###Goals / Objectives
After completing this activity, you will:

 * Know the difference between point, line, and polygon vector elements.
 * Understand the differences between opening point, line and polygon shapefiles
    in R.
 * Understand the components of a spatial object (in R).

###What you'll need

You will need the most current version of R or RStudio loaded on your computer 
to complete this lesson.

###R Libraries to Install:

* **raster:** `install.packages("raster")`
* **sp:** `install.packages("sp")`
* **rgdal:** `install.packages("rgdal")`


<a href="{{ site.baseurl }}/R/Packages-In-R/" target="_blank"> 
More on Packages in R - Adapted from Software Carpentry.</a>

##Data to Download

Download the vector files for the Harvard Forest dataset:

<a href="http://files.figshare.com/2387960/boundaryFiles.zip" class="btn btn-success"> 
DOWNLOAD Harvard Forest Shapefiles</a>

###Recommended Reading
This lesson is a part of a series on vector and raster data in R.

1. <a href="{{ site.baseurl }}/R/open-shapefiles-in-R/">
Intro to shapefiles in R</a>
2. <a href="{{ site.baseurl }}/R/shapefile-attributes-in-R/">
Working With Shapefile Attributes in R </a>
3. <a href="{{ site.baseurl }}/R/csv-to-shapefile-R/">
CSV to Shapefile in R</a>
4. <a href="{{ site.baseurl }}/R/crop-extract-raster-data-R/">
Crop and extract raster values in R</a>
 
</div>

NOTE: The data used in this tutorial were collected at Harvard Forest which is
a the National Ecological Observatory Network field site 
<a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
More about the NEON Harvard Forest field site</a>. These data are a preview of the 30 year time-series that will be collected from the NEON flux tower and made available
[from the NEON data portal](http://data.neoninc.org/ "NEON data").
{: .notice}
 
###Notes about R Libraries

We will use the `rgdal` library (package) to work with vector data in R. Notice that `sp`
is automatically loaded as a side-effect when `rgdal` is loaded. We will use the `raster`
library to work with rasters. The `rgdal` library also allows us to explore
metadata using similar commands with both rasters and vectors.

```{r load-libraries }

#load required libraries
library(rgdal)
library(raster)

```


#About Vector Data
Vector data are composed of discrete geometric locations (x,y values) that define object vertices. The organization of the geometric locations, determines the type of 
vector that we are working with (point, line or polygon) as follows: 

* **Points:** In a point vector dataset, each point is represented by a single x,y
coordinate location. There can be many points in a vector point file. Examples:
plot locations or the locations of individual trees.
* **Lines:** Lines are composed of many points that are connected. For instance,
a road or a stream is a series of straight line segments, each bend in the road
or stream represents a vertex that has an x,y location associated with it. A
line consists of AT LEAST 2 vertices that are connnected.
* **Polygons:** A polygon consists of 3 or more vertices that are connected and 
closed. Thus the outlines of plot boundaries, lakes, oceans, states or 
countries are often represented by polygons. Ocassionally, a 
polygon can have a hole in the middle of it (like a donut), this is something to
be aware of but not an issue we will deal with further.

NOTE: a line can represent a boundary as well - however a line will not create a 
closed object.

**INSERT GRAPHIC HERE**

##Shapefiles: Points, Lines, and Polygons
Geospatial data in vector format, is often stored in a `shapefile` format. 
Because the structures of points, lines, and polygons are different, each individual 
shapefile can only contain one vector type (all points, all polygons or all 
lines). You will not find a mixture of point, line and polygon objects in one shapefile!

Each component of a shapefile often has a set of associated `attributes` that
describe the data. For example, a line shapefile that contains the locations of 
streams, might contain stream names for each line.

More about shapefiles can found on [Wikipedia](https://en.wikipedia.org/wiki/Shapefile).

##Importing shapefiles

We are going to use the `R` function `readOGR()` to import shapefiles. These 
shapefiles include: 

* a polygon shapefile representing our study area boundary, 
* a line shapefile representing roads, and 
* a point shapefile representing the location of a flux tower 
<a href="http://www.neoninc.org/science-design/collection-methods/flux-tower-measurements" target="_blank">
NEON Flux Tower Measurement Methods</a> 
located at the NEON Harvard Forest field site 
<a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
NEON Harvard Forest Field Site</a>.

The first shapefile that we will open contains the boundary of our study area. 
We can use query the layer type either by entering the name of the `R` object into the console or by calling the `class()` function. In this case, we see that our object is a type of polygon layer called a `SpatialPolygonsDataFrame`.

```{r Import-Shapefile}
#set working directory to the directory location on your computer where
#you downloaded and unzipped the data files used in this lesson
#setwd("pathToDirHere")

#Import a polygon shapefile 
aoiBoundary <- readOGR("boundaryFiles/HARV", "HarClip_UTMZ18")


```

After loading a new data set we also want to view the attributes of the layer.
This can be done simple by entering the file name. Alternatively, we can use the `attributes()` function.

``` {r Shapefile-attributes}
#view attributes of the layer
aoiBoundary
```

Here `R` prints a number of attributes including information about the object's coordinate reference system. Note that the objects coordinates are UTM projected from zone 18. This information is critical to interpreting the object extent printed on the previous line. Also, note that our object only contains a single feature. We will discuss metadata and attributes in more
detail a bit later. Finally, we see that there is one variable named "id" with min and max values of 1.

We can look at all of the associated data attributes by printing the contents of the `data` slot with `@data`.  

```{r Shapefile-attributes-2}
#just view the attributes of the data
(aoiBoundary@data)
```

Recall from the previous step that our object only has a single feature. After printing the data attributes we see that the _id_ of this feature is 1. The 0 printed in the first column is simply a `row.name`. We can test this by issuing the following command to the `R` console: `row.names(aoiBoundary@data)`.

Now that we have become familiar with our object attributes we can visualize our data. The following code chunk will produce a box representing the boundaries specified in the shapefile that we just imported.

``` {r Plot-shapefile}
#create a quick plot of the shapefile
#note: lwd sets the line width!
plot(aoiBoundary,col="cyan1", border="black", lwd=3)

```


#View Shapefile Metadata

When we imported the `HarClip_UTMZ18` shapefile layer into R (as our `aoiBoundary` object) the `readOGR()` function automatically stored some key metadata including:

1. **Object Type:** - in this case our aoiBoundary object is a polygon of class `SpatialPolygonsDataFrame`
2. **CRS** - projection information (`coord ref.` in the output above) [LINK TO SPATIAL DATA INTRO LESSON?]
3. **Extent** - the spatial extent of the shapefile. Note that the spatial
extent for a shapefile represents the extent for ALL polygons (or spatial objects)
in the shapefile!

We can view the CRS, Extent and other metadata for the shapefile using the following
commands:

```{r view-crs-extent }
#view just the crs for the shapefile
crs(aoiBoundary)

#view just the extent for the shapefile
extent(aoiBoundary)

```

>#ON YOUR OWN ACTIVITY: Import a line and point shapefile
>
>Using the steps above, import the HARV_roads and HARVtower_UTM18N layers into R.
>Call the Harv_roads object `lines` and the HARVtower_UTM18N `point`
>Answer the following questions:

>1. What type of R spatial object is created when you import each layer?
>2. What is the extent and CRS for each object?
>3. Do the files contain, points, lines or polygons?
>4. How many spatial objects are in each file?
>
>Discuss the data with your neighbor as you work through this challenge!


```{r import-point-line, echo=FALSE, results="hide" }

#Import a line shapefile
lines <- readOGR("boundaryFiles/HARV",layer = "HARV_roads")
#import a point shapefile
point <- readOGR("boundaryFiles/HARV", layer="HARVtower_UTM18N")
  

#view attributes
lines
point

```

#Shapefile Metadata & Attributes

In addition to the metadata, each object has one or more attributes linked 
to it.  Attributes of an object can include measurements, descriptions, or
classifications of the object. Attribute data can be any sort of information that you might want to associate with your spatial objects. Each spatial 
object in a shapefile can have the same set of attributes or each can be 
different. 

We can view a metadata & attribute summary of each shapefile by entering 
the name of the `R` object in the console. Note that the metadata output includes
the _class_, the number of _features_, the _extent_, and the `coordinate 
reference system` (CRS) of the `R` object. The last two lines of summary show a 
preview of the `R` object _attributes_.

```{r View-Attribute-Summary}
#View all attributes 
aoiBoundary
lines
point

#view a summary of each attribute associated with the spatial object
summary(aoiBoundary)

```

We can also view specific metadata for the shapefile:

```{r view-crs-extent2 }
#view just the crs for the shapefile
crs(aoiBoundary)

#view just the extent for the shapefile
extent(aoiBoundary)

#view just the class for the shapefile
class(aoiBoundary)

```


#Plot Multiple Shapefiles

The `plot()` function can be used for basic plotting of these spatial objects. 
We use the `add = TRUE` argument to overlay shapefiles on top of each other, as
we would when creating a map in a typical GIS application like QGIS.

We can use the `main=""` to give our plot a title. If you want the title to 
span 2 lines, use `\n` where you'd like the line break.

```{r plot-multiple-shapefiles }
#Plot multiple shapefiles

plot(aoiBoundary, col = "purple", main="Harvard Forest\nStudy Area")
plot(lines, add = TRUE)

#use the pch element to adjust the symbology of the points
plot(point, add  = TRUE, pch = 19, col = "red")
```

Bonus: For more on parameter options in base r plot() check out these resources:

* <a href="http://www.statmethods.net/advgraphs/parameters.html" target="_blank">Parameter methods in R.</a>
* <a href="https://codeyarns.files.wordpress.com/2011/07/20110729-vim-named-colors.png?w=700" target="_blank">Color names in R</a>

#Another On Your Own Activity
